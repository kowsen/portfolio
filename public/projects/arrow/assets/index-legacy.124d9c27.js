!function(){function t(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var e=document.createElement("style");e.innerHTML=".grid-container.svelte-ql6bcx{position:relative;overflow:hidden;border:4px solid #666;outline:12px solid black}.grid-item.svelte-xjbr98{position:relative}.ignore-input.svelte-xjbr98{pointer-events:none}.bomb-container.svelte-2ytl5s{width:100%;height:100%;border-radius:8px;background-color:purple;opacity:.5}.overlay-tile.svelte-1fz16d2{width:100%;height:100%;border:4px solid #666;box-sizing:border-box;background-color:transparent;transition:background-color .4s ease-in-out}.is-highlighted.svelte-1fz16d2{background-color:rgba(255,65,54,.5)}.retry-container.svelte-3q1kb7{width:100%;height:100%;background-color:#666;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:48px}p.svelte-3q1kb7{margin:0;font-size:48px}.retry-button.svelte-3q1kb7{padding:32px;font-size:48px;background-color:#ccc}.scoreboard.svelte-dsqlpj{display:flex;width:608px;outline:12px solid black;padding:12px;box-sizing:border-box;background-color:#666}p.svelte-dsqlpj{font-size:48px;margin:0}.score.svelte-dsqlpj{margin-left:auto}.score-container.svelte-yirh1b{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;transform:translate(0);transition:transform 1s ease-in-out;opacity:.8}.score-text.svelte-yirh1b{font-size:20px;color:#fff;font-weight:700;filter:drop-shadow(2px 2px 0 black)}.moving.svelte-yirh1b{transform:translateY(-6px)}img.svelte-994u1w{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;user-select:none}.up.svelte-994u1w{transform:rotate(270deg)}.right.svelte-994u1w{transform:rotate(0)}.down.svelte-994u1w{transform:rotate(90deg)}.left.svelte-994u1w{transform:rotate(180deg)}.tile.svelte-1n9cgvk{width:100%;height:100%;background-color:#aaa}.tile-contents.svelte-1n9cgvk{position:absolute;left:0;top:0;width:100%;height:100%}.fork.svelte-1n9cgvk{background-color:#79a9d4}.all-fork.svelte-1n9cgvk{background-color:#7da895}.explosion.svelte-1n9cgvk{background-color:#ff851b}.holdover.svelte-1n9cgvk{background-color:red}:root,body{margin:0;padding:0;width:100%;height:100%;overflow:hidden;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;background-color:#333}#app{width:100%;height:100%}p{user-select:none}main.svelte-n6ahiz{display:flex;flex-direction:column;gap:48px;width:100%;height:100%;align-items:center;justify-content:center}.input-blocked.svelte-n6ahiz{pointer-events:none}\n",document.head.appendChild(e),System.register(["./vendor-legacy.84ccf4fa.js"],(function(){"use strict";var e,i,n,o,s,r,l,c,a,d,u,p,f,h,g,$,m,v,y,w,x,b,k,z,H,D,T,S,I,M,N,q,C,j,F,O,B,R,E,V,A,_,G;return{setters:[function(t){e=t.S,i=t.i,n=t.s,o=t.c,s=t.e,r=t.a,l=t.b,c=t.u,a=t.g,d=t.d,u=t.t,p=t.f,f=t.h,h=t.j,g=t.k,$=t.l,m=t.w,v=t.m,y=t.n,w=t.o,x=t.p,b=t.q,k=t.r,z=t.v,H=t.x,D=t.y,T=t.z,S=t.A,I=t.B,M=t.C,N=t.D,q=t.E,C=t.F,j=t.G,F=t.H,O=t.I,B=t.J,R=t.K,E=t.L,V=t.M,A=t.N,_=t.O,G=t.P}],execute:function(){var J;function P(t){let e,i;const n=t[5].default,h=o(n,t,t[4],null);return{c(){e=s("div"),h&&h.c(),r(e,"class","grid-container svelte-ql6bcx"),r(e,"style",t[0])},m(t,n){l(t,e,n),h&&h.m(e,null),i=!0},p(t,[o]){h&&h.p&&(!i||16&o)&&c(h,n,t,t[4],i?d(n,t[4],o,null):a(t[4]),null),(!i||1&o)&&r(e,"style",t[0])},i(t){i||(u(h,t),i=!0)},o(t){p(h,t),i=!1},d(t){t&&f(e),h&&h.d(t)}}}const K="getGridNodeSizeContextKey";function L(t,e,i,n){const o=g(K),s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),r=o*t.x,l=o*t.y;return`\n      position: absolute;\n      left: 0;\n      top: 0;\n      width: ${o*i.x}px;\n      height: ${o*i.y}px;\n      transform: translate(${r}px, ${l}px);\n      transition: transform ${n*s}ms linear;\n    `}function U(t,e,i){let n,{$$slots:o={},$$scope:s}=e,{nodeSize:r}=e,{width:l}=e,{height:c}=e;return h(K,r),t.$$set=t=>{"nodeSize"in t&&i(1,r=t.nodeSize),"width"in t&&i(2,l=t.width),"height"in t&&i(3,c=t.height),"$$scope"in t&&i(4,s=t.$$scope)},t.$$.update=()=>{14&t.$$.dirty&&i(0,n=`\n    width: ${r*l}px;\n    height: ${r*c}px;\n    min-height: ${r*c}px;\n  `)},[n,r,l,c,s,o]}class W extends e{constructor(t){super(),i(this,t,U,P,n,{nodeSize:1,width:2,height:3})}}const Y={};function Q(t,e){return`${t},${e}`}class X{constructor(t,e){this._x=t,this._y=e}get x(){return this._x}get y(){return this._y}static create(t=0,e=0){const i=Q(t,e);let n=Y[i];return n||(n=new X(t,e),Y[i]=n),n}add(t,e){const i=this.resolveVector(t,e);return X.create(this.x+i.x,this.y+i.y)}subtract(t,e){const i=this.resolveVector(t,e);return X.create(this.x-i.x,this.y-i.y)}invert(){return X.create(-this.x,-this.y)}toString(){return Q(this.x,this.y)}resolveVector(t,e){return t instanceof X?t:new X(t,null!=e?e:0)}}function Z(t){let e,i;const n=t[7].default,h=o(n,t,t[6],null);return{c(){e=s("div"),h&&h.c(),r(e,"class","grid-item svelte-xjbr98"),r(e,"style",t[1]),$(e,"ignore-input",t[0])},m(t,n){l(t,e,n),h&&h.m(e,null),i=!0},p(t,[o]){h&&h.p&&(!i||64&o)&&c(h,n,t,t[6],i?d(n,t[6],o,null):a(t[6]),null),(!i||2&o)&&r(e,"style",t[1]),1&o&&$(e,"ignore-input",t[0])},i(t){i||(u(h,t),i=!0)},o(t){p(h,t),i=!1},d(t){t&&f(e),h&&h.d(t)}}}function tt(t,e,i){let n,{$$slots:o={},$$scope:s}=e,{position:r}=e,{size:l=X.create(1,1)}=e,{ignoreInput:c=!1}=e,{speed:a=80}=e,d="";return t.$$set=t=>{"position"in t&&i(2,r=t.position),"size"in t&&i(3,l=t.size),"ignoreInput"in t&&i(0,c=t.ignoreInput),"speed"in t&&i(4,a=t.speed),"$$scope"in t&&i(6,s=t.$$scope)},t.$$.update=()=>{60&t.$$.dirty&&(i(1,d=n&&r!==n?L(r,n,l,a):L(r,r,l,0)),i(5,n=r))},[c,d,r,l,a,n,s,o]}class et extends e{constructor(t){super(),i(this,t,tt,Z,n,{position:2,size:3,ignoreInput:0,speed:4})}}const it="mirrorHighScore_v2",nt=m(0),ot=m(0);ot.set(JSON.parse(null!==(J=localStorage.getItem(it))&&void 0!==J?J:JSON.stringify(0)));const st=m([]);let rt=0;function lt(t,e){st.update((i=>{const n=`${rt}`;return rt+=1,i.concat([{id:n,position:t,amount:e}])}))}const ct=m([]);function at(t,e){ct.update((i=>{const n=`${rt}`;return rt+=1,i.concat([{id:n,position:t,size:e}])}))}function dt(t){let e,i,n;return{c(){e=s("div"),r(e,"class","bomb-container svelte-2ytl5s")},m(t,i){l(t,e,i),n=!0},p:z,i(t){n||(H((()=>{i||(i=D(e,T,{duration:250},!0)),i.run(1)})),n=!0)},o(t){i||(i=D(e,T,{duration:250},!1)),i.run(0),n=!1},d(t){t&&f(e),t&&i&&i.end()}}}function ut(t){let e,i;return e=new et({props:{position:t[0],size:t[1],$$slots:{default:[dt]},$$scope:{ctx:t}}}),{c(){y(e.$$.fragment)},m(t,n){w(e,t,n),i=!0},p(t,[i]){const n={};1&i&&(n.position=t[0]),2&i&&(n.size=t[1]),16&i&&(n.$$scope={dirty:i,ctx:t}),e.$set(n)},i(t){i||(u(e.$$.fragment,t),i=!0)},o(t){p(e.$$.fragment,t),i=!1},d(t){x(e,t)}}}function pt(t,e,i){let{id:n}=e,{position:o}=e,{size:s}=e,r=-1;return b((()=>{r=setTimeout((()=>{!function(t){ct.update((e=>e.filter((e=>e.id!==t))))}(n)}),600)})),k((()=>{clearTimeout(r)})),t.$$set=t=>{"id"in t&&i(2,n=t.id),"position"in t&&i(0,o=t.position),"size"in t&&i(1,s=t.size)},[o,s,n]}class ft extends e{constructor(t){super(),i(this,t,pt,ut,n,{id:2,position:0,size:1})}}function ht(t){let e;return{c(){e=s("div"),r(e,"class","overlay-tile svelte-1fz16d2"),$(e,"is-highlighted",t[1])},m(t,i){l(t,e,i)},p(t,i){2&i&&$(e,"is-highlighted",t[1])},d(t){t&&f(e)}}}function gt(t){let e,i;return e=new et({props:{position:t[0],ignoreInput:!0,$$slots:{default:[ht]},$$scope:{ctx:t}}}),{c(){y(e.$$.fragment)},m(t,n){w(e,t,n),i=!0},p(t,[i]){const n={};1&i&&(n.position=t[0]),6&i&&(n.$$scope={dirty:i,ctx:t}),e.$set(n)},i(t){i||(u(e.$$.fragment,t),i=!0)},o(t){p(e.$$.fragment,t),i=!1},d(t){x(e,t)}}}function $t(t,e,i){let{position:n}=e,{isHighlighted:o}=e;return t.$$set=t=>{"position"in t&&i(0,n=t.position),"isHighlighted"in t&&i(1,o=t.isHighlighted)},[n,o]}class mt extends e{constructor(t){super(),i(this,t,$t,gt,n,{position:0,isHighlighted:1})}}function vt(t){let e,i,n=bt(`${t[1]}`.padStart(2,"0"))+"";return{c(){e=M("HIGH SCORE: "),i=M(n)},m(t,n){l(t,e,n),l(t,i,n)},p(t,e){2&e&&n!==(n=bt(`${t[1]}`.padStart(2,"0"))+"")&&j(i,n)},d(t){t&&f(e),t&&f(i)}}}function yt(t){let e;return{c(){e=M("NEW HIGH SCORE !!!")},m(t,i){l(t,e,i)},p:z,d(t){t&&f(e)}}}function wt(t){let e,i,n,o,c,a,d,u,p,h,g,$=bt(`${t[0]}`.padStart(2,"0"))+"";function m(t,e){return t[0]===t[1]?yt:vt}let v=m(t),y=v(t);return{c(){e=s("div"),i=s("p"),n=M("SCORE: "),o=M($),c=N(),a=s("p"),y.c(),d=N(),u=s("button"),u.textContent="RETRY",r(i,"class","score svelte-3q1kb7"),r(a,"class","high-score svelte-3q1kb7"),r(u,"class","retry-button svelte-3q1kb7"),r(e,"class","retry-container svelte-3q1kb7")},m(s,r){l(s,e,r),q(e,i),q(i,n),q(i,o),q(e,c),q(e,a),y.m(a,null),q(e,d),q(e,u),h||(g=C(u,"click",t[3]),h=!0)},p(t,e){1&e&&$!==($=bt(`${t[0]}`.padStart(2,"0"))+"")&&j(o,$),v===(v=m(t))&&y?y.p(t,e):(y.d(1),y=v(t),y&&(y.c(),y.m(a,null)))},i(t){p||H((()=>{p=F(e,T,{}),p.start()}))},o:z,d(t){t&&f(e),y.d(),h=!1,g()}}}function xt(t){let e,i;return e=new et({props:{position:X.create(0,0),size:X.create(6,6),$$slots:{default:[wt]},$$scope:{ctx:t}}}),{c(){y(e.$$.fragment)},m(t,n){w(e,t,n),i=!0},p(t,[i]){const n={};19&i&&(n.$$scope={dirty:i,ctx:t}),e.$set(n)},i(t){i||(u(e.$$.fragment,t),i=!0)},o(t){p(e.$$.fragment,t),i=!1},d(t){x(e,t)}}}function bt(t){let e="";for(let i=0;i<t.length;i++)i%3==0&&0!==i&&(e=","+e),e=t.charAt(t.length-i-1)+e;return e}function kt(t,e,i){let n;S(t,ot,(t=>i(1,n=t)));let{score:o=0}=e;const s=I();return t.$$set=t=>{"score"in t&&i(0,o=t.score)},[o,n,s,()=>s("click")]}class zt extends e{constructor(t){super(),i(this,t,kt,xt,n,{score:0})}}function Ht(t){let e,i,n,o,c,a,d,u,p=Dt(`${t[1]}`.padStart(2,"0"))+"";return{c(){e=s("div"),i=s("p"),n=M(t[0]),o=M(" / "),c=M(10),a=N(),d=s("p"),u=M(p),r(i,"class","numClicks svelte-dsqlpj"),r(d,"class","score svelte-dsqlpj"),r(e,"class","scoreboard svelte-dsqlpj")},m(t,s){l(t,e,s),q(e,i),q(i,n),q(i,o),q(i,c),q(e,a),q(e,d),q(d,u)},p(t,[e]){1&e&&j(n,t[0]),2&e&&p!==(p=Dt(`${t[1]}`.padStart(2,"0"))+"")&&j(u,p)},i:z,o:z,d(t){t&&f(e)}}}function Dt(t){let e="";for(let i=0;i<t.length;i++)i%3==0&&0!==i&&(e=","+e),e=t.charAt(t.length-i-1)+e;return e}function Tt(t,e,i){let{numClicks:n}=e,{score:o}=e;return t.$$set=t=>{"numClicks"in t&&i(0,n=t.numClicks),"score"in t&&i(1,o=t.score)},[n,o]}class St extends e{constructor(t){super(),i(this,t,Tt,Ht,n,{numClicks:0,score:1})}}function It(t){let e,i,n,o,c;return{c(){e=s("div"),i=s("p"),n=M(t[1]),r(i,"class","score-text svelte-yirh1b"),r(e,"class","score-container svelte-yirh1b"),$(e,"moving",t[2])},m(t,o){l(t,e,o),q(e,i),q(i,n),c=!0},p(t,i){(!c||2&i)&&j(n,t[1]),4&i&&$(e,"moving",t[2])},i(t){c||(H((()=>{o||(o=D(e,T,{duration:250},!0)),o.run(1)})),c=!0)},o(t){o||(o=D(e,T,{duration:250},!1)),o.run(0),c=!1},d(t){t&&f(e),t&&o&&o.end()}}}function Mt(t){let e,i;return e=new et({props:{position:t[0],$$slots:{default:[It]},$$scope:{ctx:t}}}),{c(){y(e.$$.fragment)},m(t,n){w(e,t,n),i=!0},p(t,[i]){const n={};1&i&&(n.position=t[0]),70&i&&(n.$$scope={dirty:i,ctx:t}),e.$set(n)},i(t){i||(u(e.$$.fragment,t),i=!0)},o(t){p(e.$$.fragment,t),i=!1},d(t){x(e,t)}}}function Nt(t,e,i){let{id:n}=e,{position:o}=e,{amount:s}=e,r=!1,l=-1,c=-1;return b((()=>{l=setTimeout((()=>{i(2,r=!0)}),0),c=setTimeout((()=>{!function(t){st.update((e=>e.filter((e=>e.id!==t))))}(n)}),600)})),k((()=>{clearTimeout(l),clearTimeout(c)})),t.$$set=t=>{"id"in t&&i(3,n=t.id),"position"in t&&i(0,o=t.position),"amount"in t&&i(1,s=t.amount)},[o,s,r,n]}class qt extends e{constructor(t){super(),i(this,t,Nt,Mt,n,{id:3,position:0,amount:1})}}function Ct(t,e,i){const n=t.slice();return n[1]=e[i],n}function jt(t){let e,i=t[0],n=[];for(let o=0;o<i.length;o+=1)n[o]=Ot(Ct(t,i,o));return{c(){for(let t=0;t<n.length;t+=1)n[t].c();e=O()},m(t,i){for(let e=0;e<n.length;e+=1)n[e].m(t,i);l(t,e,i)},p(t,o){if(1&o){let s;for(i=t[0],s=0;s<i.length;s+=1){const r=Ct(t,i,s);n[s]?n[s].p(r,o):(n[s]=Ot(r),n[s].c(),n[s].m(e.parentNode,e))}for(;s<n.length;s+=1)n[s].d(1);n.length=i.length}},d(t){E(n,t),t&&f(e)}}}function Ft(t){let e,i,n;return{c(){e=s("img"),r(e,"class",i=B(t[0][0])+" svelte-994u1w"),R(e.src,n="full-arrow.png")||r(e,"src","full-arrow.png"),r(e,"alt","full-arrow")},m(t,i){l(t,e,i)},p(t,n){1&n&&i!==(i=B(t[0][0])+" svelte-994u1w")&&r(e,"class",i)},d(t){t&&f(e)}}}function Ot(t){let e,i,n;return{c(){e=s("img"),r(e,"class",i=B(t[1])+" svelte-994u1w"),R(e.src,n="partial-arrow.png")||r(e,"src","partial-arrow.png"),r(e,"alt","partial-arrow")},m(t,i){l(t,e,i)},p(t,n){1&n&&i!==(i=B(t[1])+" svelte-994u1w")&&r(e,"class",i)},d(t){t&&f(e)}}}function Bt(t){let e;function i(t,e){return 1===t[0].length?Ft:jt}let n=i(t),o=n(t);return{c(){o.c(),e=O()},m(t,i){o.m(t,i),l(t,e,i)},p(t,[s]){n===(n=i(t))&&o?o.p(t,s):(o.d(1),o=n(t),o&&(o.c(),o.m(e.parentNode,e)))},i:z,o:z,d(t){o.d(t),t&&f(e)}}}function Rt(t,e,i){let{directions:n}=e;return t.$$set=t=>{"directions"in t&&i(0,n=t.directions)},[n]}class Et extends e{constructor(t){super(),i(this,t,Rt,Bt,n,{directions:0})}}function Vt(t){let e,i,n,o,c,a;return n=new Et({props:{directions:t[1]}}),{c(){e=s("div"),i=s("div"),y(n.$$.fragment),r(i,"class","tile-contents svelte-1n9cgvk"),$(i,"fork",2===t[1].length),$(i,"all-fork",4===t[1].length),$(i,"explosion",t[2]),$(i,"holdover",t[3]),r(e,"class","tile svelte-1n9cgvk")},m(s,r){l(s,e,r),q(e,i),w(n,i,null),o=!0,c||(a=C(e,"mousedown",t[6]),c=!0)},p(t,e){const o={};2&e&&(o.directions=t[1]),n.$set(o),2&e&&$(i,"fork",2===t[1].length),2&e&&$(i,"all-fork",4===t[1].length),4&e&&$(i,"explosion",t[2]),8&e&&$(i,"holdover",t[3])},i(t){o||(u(n.$$.fragment,t),o=!0)},o(t){p(n.$$.fragment,t),o=!1},d(t){t&&f(e),x(n),c=!1,a()}}}function At(t){let e,i;return e=new et({props:{position:t[0],$$slots:{default:[Vt]},$$scope:{ctx:t}}}),{c(){y(e.$$.fragment)},m(t,n){w(e,t,n),i=!0},p(t,[i]){const n={};1&i&&(n.position=t[0]),270&i&&(n.$$scope={dirty:i,ctx:t}),e.$set(n)},i(t){i||(u(e.$$.fragment,t),i=!0)},o(t){p(e.$$.fragment,t),i=!1},d(t){x(e,t)}}}function _t(t,e,i){const n=I();let{position:o}=e,{directions:s}=e,{isInteractable:r}=e,{isDestroyed:l}=e,{isHoldover:c}=e;function a(){r&&!l&&n("click")}return t.$$set=t=>{"position"in t&&i(0,o=t.position),"directions"in t&&i(1,s=t.directions),"isInteractable"in t&&i(5,r=t.isInteractable),"isDestroyed"in t&&i(2,l=t.isDestroyed),"isHoldover"in t&&i(3,c=t.isHoldover)},[o,s,l,c,a,r,()=>a()]}class Gt extends e{constructor(t){super(),i(this,t,_t,At,n,{position:0,directions:1,isInteractable:5,isDestroyed:2,isHoldover:3})}}function Jt(t){const e=window.location.search.slice(1).split("&").reduce(((t,e)=>{const[i,n]=e.split("=");return t.set(i,n),t}),new Map).get(t),i=Number(e);return isNaN(i)?0:i}let Pt=0;function Kt(){const t=`${Pt}`;return Pt+=1,t}const Lt=async t=>new Promise((e=>setTimeout(e,t+Jt("delay"))));class Ut{constructor(){t(this,"tiles",m([])),t(this,"inputBlocked",m(!1)),t(this,"highlightedTiles",m([])),this.reset()}reset(){const t=[...Array(36).keys()].map((t=>{const e=t%6,i=Math.floor(t/6);return this.generateTile(X.create(e,i))}));this.tiles.set(t)}async clickTiles(t,e=2){this.inputBlocked.set(!0),this.tiles.update((e=>e.map((e=>t.includes(e.id)?{...e,isFiring:!0,isHoldover:!1,isHoldoverDisplay:!1}:e)))),this.highlightedTiles.set([]),await this.chainReact(1,e);const i=this.getNextChainTiles();this.highlightedTiles.set(i),await this.handleBomb(e),await this.destroyTiles(),await this.populateTiles(),await this.dropTiles(),i.length>0&&(await Lt(200),await this.clickTiles(i,2*e)),this.highlightedTiles.set([]),this.inputBlocked.set(!1)}getDirectionVector(t){switch(t){case"up":return X.create(0,-1);case"right":return X.create(1,0);case"down":return X.create(0,1);case"left":return X.create(-1,0)}}flip(t){switch(t){case"up":return"down";case"right":return"left";case"down":return"up";case"left":return"right"}}async chainReact(t,e){this.tiles.update((t=>{const i=t.filter((t=>t.isDestroyed||t.isFiring)).length;let n=t.filter((t=>t.isFiring)),o=[];for(const e of n)if(1===e.directions.length){const t=e.position.add(this.getDirectionVector(e.directions[0])),i=n.find((e=>e.position===t));i&&1===i.directions.length&&i.position.add(this.getDirectionVector(i.directions[0]))===e.position&&(o.push(e.id),o.push(i.id))}n=(t=t.map((t=>o.includes(t.id)?{...t,directions:["up","right","down","left"]}:t))).filter((t=>t.isFiring));const s=[],r=[];for(const e of n)for(const i of e.directions){const n=e.position.add(this.getDirectionVector(i)),o=t.find((t=>t.position===n));o&&1===o.directions.length&&o.directions[0]===this.flip(i)?s.push(n):r.push(n)}return t.map((t=>{if(t.isFiring){const n=Math.min(e*i*i*100,128e3);return nt.update((t=>t+n)),lt(t.position,n),{...t,isFiring:!1,isDestroyed:!0}}return!r.includes(t.position)||t.isFiring||t.isDestroyed||t.isHoldover||s.includes(t.position)?t.isHoldover?{...t,isHoldoverDisplay:!0}:s.includes(t.position)&&!t.isDestroyed?{...t,isHoldover:!0,isFiring:!1}:t:{...t,isFiring:!0,isHoldover:!1,isHoldoverDisplay:!1}}))})),await Lt(100),v(this.tiles).find((t=>t.isFiring||t.isHoldover&&!t.isHoldoverDisplay))&&await this.chainReact(t+1,e)}getNextChainTiles(){return v(this.tiles).filter((t=>t.isHoldover)).map((t=>t.id))}async handleBomb(t){const e=[],i=[];if(this.tiles.update((t=>{if(t.find((t=>t.isHoldover)))return t;for(const n of t)if(n.isDestroyed)for(const t of n.directions){const o=n.position.add(this.getDirectionVector(t));(o.x<0||o.x>=6)&&i.push(n.position.y),(o.y<0||o.y>=6)&&e.push(n.position.x)}return t})),e.length>0||i.length>0){await Lt(400);for(const t of e)at(X.create(t,0),X.create(1,6));for(const t of i)at(X.create(0,t),X.create(6,1));this.tiles.update((n=>{const o=n.filter((t=>t.isDestroyed||t.isFiring)).length;return n.map((n=>{if(e.includes(n.position.x)||i.includes(n.position.y)){const e=Math.min(t*o*o*500,256e3);return nt.update((t=>t+e)),lt(n.position,e),{...n,isDestroyed:!0}}return n}))})),await Lt(350)}}async destroyTiles(){await Lt(250),this.tiles.update((t=>t.filter((t=>!t.isDestroyed))))}async populateTiles(){this.tiles.update((t=>{const e=[];for(let i=0;i<6;i++)for(let n=0;n<6;n++){const o=X.create(i,n);if(!t.find((t=>t.position===o))){let t=-1;for(;e.includes(X.create(i,t));)t-=1;e.push(X.create(i,t))}}return t.concat(e.map((t=>this.generateTile(t))))})),await Lt(100)}async dropTiles(){const t={};this.tiles.update((e=>{for(e=e.map((t=>({...t})));e.find((t=>t.position.y<0));)for(const n of e){const o=n.position.add(0,1);var i;if(o.y<6&&!e.find((t=>t.position===o)))n.position=o,t[n.id]=(null!==(i=t[n.id])&&void 0!==i?i:0)+1}return e}));let e=0;for(const i of Object.keys(t))e=Math.max(e,t[i]);await Lt(80*e)}generateTile(t){return{id:Kt(),position:t,directions:this.generateDirections(),isFiring:!1,isInteractable:!0,isDestroyed:!1,isHoldover:!1,isHoldoverDisplay:!1}}generateDirections(){const t=Math.random(),e=t<.8?1:t<.95?2:4;return Wt([Wt(["up","down"]),Wt(["left","right"])]).flat().slice(0,e)}}function Wt(t){let e,i=(t=[...t]).length;for(;0!=i;)e=Math.floor(Math.random()*i),i--,[t[i],t[e]]=[t[e],t[i]];return t}function Yt(t,e,i){const n=t.slice();return n[21]=e[i],n}function Qt(t,e,i){const n=t.slice();return n[21]=e[i],n}function Xt(t,e,i){const n=t.slice();return n[26]=e[i],n}function Zt(t,e,i){const n=t.slice();return n[29]=e[i],n}function te(t,e){let i,n,o;return n=new Gt({props:{position:e[29].position,directions:e[29].directions,isInteractable:e[29].isInteractable&&1===e[29].directions.length,isDestroyed:e[29].isDestroyed,isHoldover:e[7].includes(e[29].id)||e[29].isHoldoverDisplay}}),n.$on("click",(function(){return e[19](e[29])})),{key:t,first:null,c(){i=O(),y(n.$$.fragment),this.first=i},m(t,e){l(t,i,e),w(n,t,e),o=!0},p(t,i){e=t;const o={};64&i[0]&&(o.position=e[29].position),64&i[0]&&(o.directions=e[29].directions),64&i[0]&&(o.isInteractable=e[29].isInteractable&&1===e[29].directions.length),64&i[0]&&(o.isDestroyed=e[29].isDestroyed),192&i[0]&&(o.isHoldover=e[7].includes(e[29].id)||e[29].isHoldoverDisplay),n.$set(o)},i(t){o||(u(n.$$.fragment,t),o=!0)},o(t){p(n.$$.fragment,t),o=!1},d(t){t&&f(i),x(n,t)}}}function ee(t){let e,i;return e=new mt({props:{position:t[26],isHighlighted:!1}}),{c(){y(e.$$.fragment)},m(t,n){w(e,t,n),i=!0},p:z,i(t){i||(u(e.$$.fragment,t),i=!0)},o(t){p(e.$$.fragment,t),i=!1},d(t){x(e,t)}}}function ie(t,e){let i,n,o;return n=new ft({props:{id:e[21].id,position:e[21].position,size:e[21].size}}),{key:t,first:null,c(){i=O(),y(n.$$.fragment),this.first=i},m(t,e){l(t,i,e),w(n,t,e),o=!0},p(t,i){e=t;const o={};256&i[0]&&(o.id=e[21].id),256&i[0]&&(o.position=e[21].position),256&i[0]&&(o.size=e[21].size),n.$set(o)},i(t){o||(u(n.$$.fragment,t),o=!0)},o(t){p(n.$$.fragment,t),o=!1},d(t){t&&f(i),x(n,t)}}}function ne(t,e){let i,n,o;return n=new qt({props:{id:e[21].id,position:e[21].position,amount:e[21].amount}}),{key:t,first:null,c(){i=O(),y(n.$$.fragment),this.first=i},m(t,e){l(t,i,e),w(n,t,e),o=!0},p(t,i){e=t;const o={};512&i[0]&&(o.id=e[21].id),512&i[0]&&(o.position=e[21].position),512&i[0]&&(o.amount=e[21].amount),n.$set(o)},i(t){o||(u(n.$$.fragment,t),o=!0)},o(t){p(n.$$.fragment,t),o=!1},d(t){t&&f(i),x(n,t)}}}function oe(t){let e,i;return e=new zt({props:{score:t[10]}}),e.$on("click",t[20]),{c(){y(e.$$.fragment)},m(t,n){w(e,t,n),i=!0},p(t,i){const n={};1024&i[0]&&(n.score=t[10]),e.$set(n)},i(t){i||(u(e.$$.fragment,t),i=!0)},o(t){p(e.$$.fragment,t),i=!1},d(t){x(e,t)}}}function se(t){let e,i,n,o,s,r,c=[],a=new Map,d=[],h=new Map,g=[],$=new Map,m=t[6];const v=t=>t[29].id;for(let l=0;l<m.length;l+=1){let e=Zt(t,m,l),i=v(e);a.set(i,c[l]=te(i,e))}let y=t[15],w=[];for(let l=0;l<y.length;l+=1)w[l]=ee(Xt(t,y,l));const x=t=>p(w[t],1,1,(()=>{w[t]=null}));let b=t[8];const k=t=>t[21].id;for(let l=0;l<b.length;l+=1){let e=Qt(t,b,l),i=k(e);h.set(i,d[l]=ie(i,e))}let z=t[9];const H=t=>t[21].id;for(let l=0;l<z.length;l+=1){let e=Yt(t,z,l),i=H(e);$.set(i,g[l]=ne(i,e))}let D=t[2]>=10&&!t[3]&&oe(t);return{c(){for(let t=0;t<c.length;t+=1)c[t].c();e=N();for(let t=0;t<w.length;t+=1)w[t].c();i=N();for(let t=0;t<d.length;t+=1)d[t].c();n=N();for(let t=0;t<g.length;t+=1)g[t].c();o=N(),D&&D.c(),s=O()},m(t,a){for(let e=0;e<c.length;e+=1)c[e].m(t,a);l(t,e,a);for(let e=0;e<w.length;e+=1)w[e].m(t,a);l(t,i,a);for(let e=0;e<d.length;e+=1)d[e].m(t,a);l(t,n,a);for(let e=0;e<g.length;e+=1)g[e].m(t,a);l(t,o,a),D&&D.m(t,a),l(t,s,a),r=!0},p(t,r){if(2252&r[0]&&(m=t[6],V(),c=A(c,r,v,1,t,m,a,e.parentNode,G,te,e,Zt),_()),32768&r[0]){let e;for(y=t[15],e=0;e<y.length;e+=1){const n=Xt(t,y,e);w[e]?(w[e].p(n,r),u(w[e],1)):(w[e]=ee(n),w[e].c(),u(w[e],1),w[e].m(i.parentNode,i))}for(V(),e=y.length;e<w.length;e+=1)x(e);_()}256&r[0]&&(b=t[8],V(),d=A(d,r,k,1,t,b,h,n.parentNode,G,ie,n,Qt),_()),512&r[0]&&(z=t[9],V(),g=A(g,r,H,1,t,z,$,o.parentNode,G,ne,o,Yt),_()),t[2]>=10&&!t[3]?D?(D.p(t,r),12&r[0]&&u(D,1)):(D=oe(t),D.c(),u(D,1),D.m(s.parentNode,s)):D&&(V(),p(D,1,1,(()=>{D=null})),_())},i(t){if(!r){for(let t=0;t<m.length;t+=1)u(c[t]);for(let t=0;t<y.length;t+=1)u(w[t]);for(let t=0;t<b.length;t+=1)u(d[t]);for(let t=0;t<z.length;t+=1)u(g[t]);u(D),r=!0}},o(t){for(let e=0;e<c.length;e+=1)p(c[e]);w=w.filter(Boolean);for(let e=0;e<w.length;e+=1)p(w[e]);for(let e=0;e<d.length;e+=1)p(d[e]);for(let e=0;e<g.length;e+=1)p(g[e]);p(D),r=!1},d(t){for(let e=0;e<c.length;e+=1)c[e].d(t);t&&f(e),E(w,t),t&&f(i);for(let e=0;e<d.length;e+=1)d[e].d(t);t&&f(n);for(let e=0;e<g.length;e+=1)g[e].d(t);t&&f(o),D&&D.d(t),t&&f(s)}}}function re(t){let e,i,n,o,c,a,d;return H(t[18]),i=new W({props:{nodeSize:100,width:6,height:6,$$slots:{default:[se]},$$scope:{ctx:t}}}),o=new St({props:{numClicks:t[2],score:t[10]}}),{c(){e=s("main"),y(i.$$.fragment),n=N(),y(o.$$.fragment),r(e,"style",t[4]),r(e,"class","svelte-n6ahiz"),$(e,"input-blocked",t[5])},m(s,r){l(s,e,r),w(i,e,null),q(e,n),w(o,e,null),c=!0,a||(d=C(window,"resize",t[18]),a=!0)},p(t,n){const s={};1996&n[0]|2&n[1]&&(s.$$scope={dirty:n,ctx:t}),i.$set(s);const l={};4&n[0]&&(l.numClicks=t[2]),1024&n[0]&&(l.score=t[10]),o.$set(l),(!c||16&n[0])&&r(e,"style",t[4]),32&n[0]&&$(e,"input-blocked",t[5])},i(t){c||(u(i.$$.fragment,t),u(o.$$.fragment,t),c=!0)},o(t){p(i.$$.fragment,t),p(o.$$.fragment,t),c=!1},d(t){t&&f(e),x(i),x(o),a=!1,d()}}}function le(t,e,i){let n,o,s,r,l,c,a,d;S(t,ct,(t=>i(8,c=t))),S(t,st,(t=>i(9,a=t))),S(t,nt,(t=>i(10,d=t)));const u=new Ut,p=u.inputBlocked;S(t,p,(t=>i(5,s=t)));const f=u.tiles;S(t,f,(t=>i(6,r=t)));const h=u.highlightedTiles;S(t,h,(t=>i(7,l=t)));const g=[...Array(36).keys()].map((t=>X.create(t%6,Math.floor(t/6))));let $,m,y=0,w=!1;function x(){i(2,y=0),nt.set(0),u.reset()}return t.$$.update=()=>{3&t.$$.dirty[0]&&i(17,n=function(t,e){return t>720&&e>840?1:Math.min(t/720,e/840)}($,m)),131072&t.$$.dirty[0]&&i(4,o=`transform: scale(${n})`)},[$,m,y,w,o,s,r,l,c,a,d,u,p,f,h,g,x,n,function(){i(0,$=window.innerWidth),i(1,m=window.innerHeight)},async t=>{i(2,y+=1),i(3,w=!0),await u.clickTiles([t.id]),y>=10&&function(){const t=v(nt);v(ot)<t&&(ot.set(t),localStorage.setItem(it,JSON.stringify(t)))}(),i(3,w=!1)},()=>x()]}new class extends e{constructor(t){super(),i(this,t,le,re,n,{},null,[-1,-1])}}({target:document.getElementById("app")})}}}))}();
