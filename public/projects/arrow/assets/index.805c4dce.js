var xe=Object.defineProperty,et=Object.defineProperties;var tt=Object.getOwnPropertyDescriptors;var be=Object.getOwnPropertySymbols;var it=Object.prototype.hasOwnProperty,nt=Object.prototype.propertyIsEnumerable;var de=(o,e,t)=>e in o?xe(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,O=(o,e)=>{for(var t in e||(e={}))it.call(e,t)&&de(o,t,e[t]);if(be)for(var t of be(e))nt.call(e,t)&&de(o,t,e[t]);return o},j=(o,e)=>et(o,tt(e));var ne=(o,e,t)=>(de(o,typeof e!="symbol"?e+"":e,t),t);import{S as q,i as A,s as E,c as je,e as D,a as m,b as y,u as Le,g as Ke,d as Ve,t as p,f as w,h as v,j as st,k as ot,l as N,w as Y,m as se,n as M,o as C,p as B,q as Je,r as Ye,v as K,x as ue,y as oe,z as Z,A as J,B as We,C as G,D as L,E as H,F as me,G as x,H as rt,I as Q,J as re,K as Qe,L as Xe,M as X,N as he,O as U,P as ge}from"./vendor.1c237551.js";function ii(){import("data:text/javascript,")}const lt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}};lt();function ct(o){let e,t;const i=o[5].default,n=je(i,o,o[4],null);return{c(){e=D("div"),n&&n.c(),m(e,"class","grid-container svelte-ql6bcx"),m(e,"style",o[0])},m(s,r){y(s,e,r),n&&n.m(e,null),t=!0},p(s,[r]){n&&n.p&&(!t||r&16)&&Le(n,i,s,s[4],t?Ve(i,s[4],r,null):Ke(s[4]),null),(!t||r&1)&&m(e,"style",s[0])},i(s){t||(p(n,s),t=!0)},o(s){w(n,s),t=!1},d(s){s&&v(e),n&&n.d(s)}}}const Ue="getGridNodeSizeContextKey";function we(o,e,t,i){const n=ot(Ue),s=Math.sqrt(Math.pow(o.x-e.x,2)+Math.pow(o.y-e.y,2)),r=n*o.x,l=n*o.y;return`
      position: absolute;
      left: 0;
      top: 0;
      width: ${n*t.x}px;
      height: ${n*t.y}px;
      transform: translate(${r}px, ${l}px);
      transition: transform ${i*s}ms linear;
    `}function at(o,e,t){let i,{$$slots:n={},$$scope:s}=e,{nodeSize:r}=e,{width:l}=e,{height:u}=e;return st(Ue,r),o.$$set=a=>{"nodeSize"in a&&t(1,r=a.nodeSize),"width"in a&&t(2,l=a.width),"height"in a&&t(3,u=a.height),"$$scope"in a&&t(4,s=a.$$scope)},o.$$.update=()=>{o.$$.dirty&14&&t(0,i=`
    width: ${r*l}px;
    height: ${r*u}px;
    min-height: ${r*u}px;
  `)},[i,r,l,u,s,n]}class ft extends q{constructor(e){super();A(this,e,at,ct,E,{nodeSize:1,width:2,height:3})}}const ke={};function Te(o,e){return`${o},${e}`}class b{constructor(e,t){this._x=e,this._y=t}get x(){return this._x}get y(){return this._y}static create(e=0,t=0){const i=Te(e,t);let n=ke[i];return n||(n=new b(e,t),ke[i]=n),n}add(e,t){const i=this.resolveVector(e,t);return b.create(this.x+i.x,this.y+i.y)}subtract(e,t){const i=this.resolveVector(e,t);return b.create(this.x-i.x,this.y-i.y)}invert(){return b.create(-this.x,-this.y)}toString(){return Te(this.x,this.y)}resolveVector(e,t){return e instanceof b?e:new b(e,t!=null?t:0)}}function ut(o){let e,t;const i=o[7].default,n=je(i,o,o[6],null);return{c(){e=D("div"),n&&n.c(),m(e,"class","grid-item svelte-xjbr98"),m(e,"style",o[1]),N(e,"ignore-input",o[0])},m(s,r){y(s,e,r),n&&n.m(e,null),t=!0},p(s,[r]){n&&n.p&&(!t||r&64)&&Le(n,i,s,s[6],t?Ve(i,s[6],r,null):Ke(s[6]),null),(!t||r&2)&&m(e,"style",s[1]),r&1&&N(e,"ignore-input",s[0])},i(s){t||(p(n,s),t=!0)},o(s){w(n,s),t=!1},d(s){s&&v(e),n&&n.d(s)}}}function dt(o,e,t){let{$$slots:i={},$$scope:n}=e,{position:s}=e,{size:r=b.create(1,1)}=e,{ignoreInput:l=!1}=e,{speed:u=80}=e,a="",_;return o.$$set=d=>{"position"in d&&t(2,s=d.position),"size"in d&&t(3,r=d.size),"ignoreInput"in d&&t(0,l=d.ignoreInput),"speed"in d&&t(4,u=d.speed),"$$scope"in d&&t(6,n=d.$$scope)},o.$$.update=()=>{o.$$.dirty&60&&(_&&s!==_?t(1,a=we(s,_,r,u)):t(1,a=we(s,s,r,0)),t(5,_=s))},[l,a,s,r,u,_,n,i]}class te extends q{constructor(e){super();A(this,e,dt,ut,E,{position:2,size:3,ignoreInput:0,speed:4})}}const Ze="mirrorHighScore_v2",ee=Y(0),le=Y(0);function ht(){const o=se(ee);return se(le)<o?(le.set(o),localStorage.setItem(Ze,JSON.stringify(o)),!0):!1}var Pe;le.set(JSON.parse((Pe=localStorage.getItem(Ze))!=null?Pe:JSON.stringify(0)));const pe=Y([]);let ce=0;function Se(o,e){pe.update(t=>{const i=`${ce}`;return ce+=1,t.concat([{id:i,position:o,amount:e}])})}function gt(o){pe.update(e=>e.filter(t=>t.id!==o))}const ye=Y([]);function He(o,e){ye.update(t=>{const i=`${ce}`;return ce+=1,t.concat([{id:i,position:o,size:e}])})}function _t(o){ye.update(e=>e.filter(t=>t.id!==o))}function mt(o){let e,t,i;return{c(){e=D("div"),m(e,"class","bomb-container svelte-2ytl5s")},m(n,s){y(n,e,s),i=!0},p:K,i(n){i||(ue(()=>{t||(t=oe(e,Z,{duration:250},!0)),t.run(1)}),i=!0)},o(n){t||(t=oe(e,Z,{duration:250},!1)),t.run(0),i=!1},d(n){n&&v(e),n&&t&&t.end()}}}function pt(o){let e,t;return e=new te({props:{position:o[0],size:o[1],$$slots:{default:[mt]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},m(i,n){C(e,i,n),t=!0},p(i,[n]){const s={};n&1&&(s.position=i[0]),n&2&&(s.size=i[1]),n&16&&(s.$$scope={dirty:n,ctx:i}),e.$set(s)},i(i){t||(p(e.$$.fragment,i),t=!0)},o(i){w(e.$$.fragment,i),t=!1},d(i){B(e,i)}}}function yt(o,e,t){let{id:i}=e,{position:n}=e,{size:s}=e,r=-1;return Je(()=>{r=setTimeout(()=>{_t(i)},600)}),Ye(()=>{clearTimeout(r)}),o.$$set=l=>{"id"in l&&t(2,i=l.id),"position"in l&&t(0,n=l.position),"size"in l&&t(1,s=l.size)},[n,s,i]}class vt extends q{constructor(e){super();A(this,e,yt,pt,E,{id:2,position:0,size:1})}}const S=6,ae=10;function bt(o){let e;return{c(){e=D("div"),m(e,"class","overlay-tile svelte-1fz16d2"),N(e,"is-highlighted",o[1])},m(t,i){y(t,e,i)},p(t,i){i&2&&N(e,"is-highlighted",t[1])},d(t){t&&v(e)}}}function wt(o){let e,t;return e=new te({props:{position:o[0],ignoreInput:!0,$$slots:{default:[bt]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},m(i,n){C(e,i,n),t=!0},p(i,[n]){const s={};n&1&&(s.position=i[0]),n&6&&(s.$$scope={dirty:n,ctx:i}),e.$set(s)},i(i){t||(p(e.$$.fragment,i),t=!0)},o(i){w(e.$$.fragment,i),t=!1},d(i){B(e,i)}}}function kt(o,e,t){let{position:i}=e,{isHighlighted:n}=e;return o.$$set=s=>{"position"in s&&t(0,i=s.position),"isHighlighted"in s&&t(1,n=s.isHighlighted)},[i,n]}class Tt extends q{constructor(e){super();A(this,e,kt,wt,E,{position:0,isHighlighted:1})}}function St(o){let e,t=fe(`${o[1]}`.padStart(2,"0"))+"",i;return{c(){e=G("HIGH SCORE: "),i=G(t)},m(n,s){y(n,e,s),y(n,i,s)},p(n,s){s&2&&t!==(t=fe(`${n[1]}`.padStart(2,"0"))+"")&&x(i,t)},d(n){n&&v(e),n&&v(i)}}}function Ht(o){let e;return{c(){e=G("NEW HIGH SCORE !!!")},m(t,i){y(t,e,i)},p:K,d(t){t&&v(e)}}}function Dt(o){let e,t,i,n=fe(`${o[0]}`.padStart(2,"0"))+"",s,r,l,u,a,_,d,I;function z(g,$){return g[0]===g[1]?Ht:St}let F=z(o),k=F(o);return{c(){e=D("div"),t=D("p"),i=G("SCORE: "),s=G(n),r=L(),l=D("p"),k.c(),u=L(),a=D("button"),a.textContent="RETRY",m(t,"class","score svelte-3q1kb7"),m(l,"class","high-score svelte-3q1kb7"),m(a,"class","retry-button svelte-3q1kb7"),m(e,"class","retry-container svelte-3q1kb7")},m(g,$){y(g,e,$),H(e,t),H(t,i),H(t,s),H(e,r),H(e,l),k.m(l,null),H(e,u),H(e,a),d||(I=me(a,"click",o[3]),d=!0)},p(g,$){$&1&&n!==(n=fe(`${g[0]}`.padStart(2,"0"))+"")&&x(s,n),F===(F=z(g))&&k?k.p(g,$):(k.d(1),k=F(g),k&&(k.c(),k.m(l,null)))},i(g){_||ue(()=>{_=rt(e,Z,{}),_.start()})},o:K,d(g){g&&v(e),k.d(),d=!1,I()}}}function It(o){let e,t;return e=new te({props:{position:b.create(0,0),size:b.create(S,S),$$slots:{default:[Dt]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},m(i,n){C(e,i,n),t=!0},p(i,[n]){const s={};n&19&&(s.$$scope={dirty:n,ctx:i}),e.$set(s)},i(i){t||(p(e.$$.fragment,i),t=!0)},o(i){w(e.$$.fragment,i),t=!1},d(i){B(e,i)}}}function fe(o){let e="";for(let t=0;t<o.length;t++)t%3===0&&t!==0&&(e=","+e),e=o.charAt(o.length-t-1)+e;return e}function Nt(o,e,t){let i;J(o,le,l=>t(1,i=l));let{score:n=0}=e;const s=We(),r=()=>s("click");return o.$$set=l=>{"score"in l&&t(0,n=l.score)},[n,i,s,r]}class zt extends q{constructor(e){super();A(this,e,Nt,It,E,{score:0})}}function Mt(o){let e,t,i,n,s,r,l,u=De(`${o[1]}`.padStart(2,"0"))+"",a;return{c(){e=D("div"),t=D("p"),i=G(o[0]),n=G(" / "),s=G(ae),r=L(),l=D("p"),a=G(u),m(t,"class","numClicks svelte-dsqlpj"),m(l,"class","score svelte-dsqlpj"),m(e,"class","scoreboard svelte-dsqlpj")},m(_,d){y(_,e,d),H(e,t),H(t,i),H(t,n),H(t,s),H(e,r),H(e,l),H(l,a)},p(_,[d]){d&1&&x(i,_[0]),d&2&&u!==(u=De(`${_[1]}`.padStart(2,"0"))+"")&&x(a,u)},i:K,o:K,d(_){_&&v(e)}}}function De(o){let e="";for(let t=0;t<o.length;t++)t%3===0&&t!==0&&(e=","+e),e=o.charAt(o.length-t-1)+e;return e}function Ct(o,e,t){let{numClicks:i}=e,{score:n}=e;return o.$$set=s=>{"numClicks"in s&&t(0,i=s.numClicks),"score"in s&&t(1,n=s.score)},[i,n]}class Bt extends q{constructor(e){super();A(this,e,Ct,Mt,E,{numClicks:0,score:1})}}function $t(o){let e,t,i,n,s;return{c(){e=D("div"),t=D("p"),i=G(o[1]),m(t,"class","score-text svelte-yirh1b"),m(e,"class","score-container svelte-yirh1b"),N(e,"moving",o[2])},m(r,l){y(r,e,l),H(e,t),H(t,i),s=!0},p(r,l){(!s||l&2)&&x(i,r[1]),l&4&&N(e,"moving",r[2])},i(r){s||(ue(()=>{n||(n=oe(e,Z,{duration:250},!0)),n.run(1)}),s=!0)},o(r){n||(n=oe(e,Z,{duration:250},!1)),n.run(0),s=!1},d(r){r&&v(e),r&&n&&n.end()}}}function Ft(o){let e,t;return e=new te({props:{position:o[0],$$slots:{default:[$t]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},m(i,n){C(e,i,n),t=!0},p(i,[n]){const s={};n&1&&(s.position=i[0]),n&70&&(s.$$scope={dirty:n,ctx:i}),e.$set(s)},i(i){t||(p(e.$$.fragment,i),t=!0)},o(i){w(e.$$.fragment,i),t=!1},d(i){B(e,i)}}}function Gt(o,e,t){let{id:i}=e,{position:n}=e,{amount:s}=e,r=!1,l=-1,u=-1;return Je(()=>{l=setTimeout(()=>{t(2,r=!0)},0),u=setTimeout(()=>{gt(i)},600)}),Ye(()=>{clearTimeout(l),clearTimeout(u)}),o.$$set=a=>{"id"in a&&t(3,i=a.id),"position"in a&&t(0,n=a.position),"amount"in a&&t(1,s=a.amount)},[n,s,r,i]}class qt extends q{constructor(e){super();A(this,e,Gt,Ft,E,{id:3,position:0,amount:1})}}function Ie(o,e,t){const i=o.slice();return i[1]=e[t],i}function At(o){let e,t=o[0],i=[];for(let n=0;n<t.length;n+=1)i[n]=Ne(Ie(o,t,n));return{c(){for(let n=0;n<i.length;n+=1)i[n].c();e=Q()},m(n,s){for(let r=0;r<i.length;r+=1)i[r].m(n,s);y(n,e,s)},p(n,s){if(s&1){t=n[0];let r;for(r=0;r<t.length;r+=1){const l=Ie(n,t,r);i[r]?i[r].p(l,s):(i[r]=Ne(l),i[r].c(),i[r].m(e.parentNode,e))}for(;r<i.length;r+=1)i[r].d(1);i.length=t.length}},d(n){Xe(i,n),n&&v(e)}}}function Et(o){let e,t,i;return{c(){e=D("img"),m(e,"class",t=re(o[0][0])+" svelte-994u1w"),Qe(e.src,i="full-arrow.png")||m(e,"src",i),m(e,"alt","full-arrow")},m(n,s){y(n,e,s)},p(n,s){s&1&&t!==(t=re(n[0][0])+" svelte-994u1w")&&m(e,"class",t)},d(n){n&&v(e)}}}function Ne(o){let e,t,i;return{c(){e=D("img"),m(e,"class",t=re(o[1])+" svelte-994u1w"),Qe(e.src,i="partial-arrow.png")||m(e,"src",i),m(e,"alt","partial-arrow")},m(n,s){y(n,e,s)},p(n,s){s&1&&t!==(t=re(n[1])+" svelte-994u1w")&&m(e,"class",t)},d(n){n&&v(e)}}}function Rt(o){let e;function t(s,r){return s[0].length===1?Et:At}let i=t(o),n=i(o);return{c(){n.c(),e=Q()},m(s,r){n.m(s,r),y(s,e,r)},p(s,[r]){i===(i=t(s))&&n?n.p(s,r):(n.d(1),n=i(s),n&&(n.c(),n.m(e.parentNode,e)))},i:K,o:K,d(s){n.d(s),s&&v(e)}}}function Ot(o,e,t){let{directions:i}=e;return o.$$set=n=>{"directions"in n&&t(0,i=n.directions)},[i]}class Pt extends q{constructor(e){super();A(this,e,Ot,Rt,E,{directions:0})}}function jt(o){let e,t,i,n,s,r;return i=new Pt({props:{directions:o[1]}}),{c(){e=D("div"),t=D("div"),M(i.$$.fragment),m(t,"class","tile-contents svelte-1n9cgvk"),N(t,"fork",o[1].length===2),N(t,"all-fork",o[1].length===4),N(t,"explosion",o[2]),N(t,"holdover",o[3]),m(e,"class","tile svelte-1n9cgvk")},m(l,u){y(l,e,u),H(e,t),C(i,t,null),n=!0,s||(r=me(e,"mousedown",o[6]),s=!0)},p(l,u){const a={};u&2&&(a.directions=l[1]),i.$set(a),u&2&&N(t,"fork",l[1].length===2),u&2&&N(t,"all-fork",l[1].length===4),u&4&&N(t,"explosion",l[2]),u&8&&N(t,"holdover",l[3])},i(l){n||(p(i.$$.fragment,l),n=!0)},o(l){w(i.$$.fragment,l),n=!1},d(l){l&&v(e),B(i),s=!1,r()}}}function Lt(o){let e,t;return e=new te({props:{position:o[0],$$slots:{default:[jt]},$$scope:{ctx:o}}}),{c(){M(e.$$.fragment)},m(i,n){C(e,i,n),t=!0},p(i,[n]){const s={};n&1&&(s.position=i[0]),n&270&&(s.$$scope={dirty:n,ctx:i}),e.$set(s)},i(i){t||(p(e.$$.fragment,i),t=!0)},o(i){w(e.$$.fragment,i),t=!1},d(i){B(e,i)}}}function Kt(o,e,t){const i=We();let{position:n}=e,{directions:s}=e,{isInteractable:r}=e,{isDestroyed:l}=e,{isHoldover:u}=e;function a(){r&&!l&&i("click")}const _=()=>a();return o.$$set=d=>{"position"in d&&t(0,n=d.position),"directions"in d&&t(1,s=d.directions),"isInteractable"in d&&t(5,r=d.isInteractable),"isDestroyed"in d&&t(2,l=d.isDestroyed),"isHoldover"in d&&t(3,u=d.isHoldover)},[n,s,l,u,a,r,_]}class Vt extends q{constructor(e){super();A(this,e,Kt,Lt,E,{position:0,directions:1,isInteractable:5,isDestroyed:2,isHoldover:3})}}function Jt(o){const e=Yt().get(o),t=Number(e);return isNaN(t)?0:t}function Yt(){return window.location.search.slice(1).split("&").reduce((o,e)=>{const[t,i]=e.split("=");return o.set(t,i),o},new Map)}let ze=0;function Wt(){const o=`${ze}`;return ze+=1,o}const V=async o=>new Promise(e=>setTimeout(e,o+Jt("delay")));class Qt{constructor(){ne(this,"tiles",Y([]));ne(this,"inputBlocked",Y(!1));ne(this,"highlightedTiles",Y([]));this.reset()}reset(){const e=[...Array(S*S).keys()].map(t=>{const i=t%S,n=Math.floor(t/S);return this.generateTile(b.create(i,n))});this.tiles.set(e)}async clickTiles(e,t=2){this.inputBlocked.set(!0),this.tiles.update(n=>n.map(s=>e.includes(s.id)?j(O({},s),{isFiring:!0,isHoldover:!1,isHoldoverDisplay:!1}):s)),this.highlightedTiles.set([]),await this.chainReact(1,t);const i=this.getNextChainTiles();this.highlightedTiles.set(i),await this.handleBomb(t),await this.destroyTiles(),await this.populateTiles(),await this.dropTiles(),i.length>0&&(await V(200),await this.clickTiles(i,t*2)),this.highlightedTiles.set([]),this.inputBlocked.set(!1)}getDirectionVector(e){switch(e){case"up":return b.create(0,-1);case"right":return b.create(1,0);case"down":return b.create(0,1);case"left":return b.create(-1,0)}}flip(e){switch(e){case"up":return"down";case"right":return"left";case"down":return"up";case"left":return"right"}}async chainReact(e,t){this.tiles.update(i=>{const n=i.filter(a=>a.isDestroyed||a.isFiring).length;let s=i.filter(a=>a.isFiring),r=[];for(const a of s)if(a.directions.length===1){const _=a.position.add(this.getDirectionVector(a.directions[0])),d=s.find(I=>I.position===_);d&&d.directions.length===1&&d.position.add(this.getDirectionVector(d.directions[0]))===a.position&&(r.push(a.id),r.push(d.id))}i=i.map(a=>r.includes(a.id)?j(O({},a),{directions:["up","right","down","left"]}):a),s=i.filter(a=>a.isFiring);const l=[],u=[];for(const a of s)for(const _ of a.directions){const d=a.position.add(this.getDirectionVector(_)),I=i.find(z=>z.position===d);I&&I.directions.length===1&&I.directions[0]===this.flip(_)?l.push(d):u.push(d)}return i.map(a=>{if(a.isFiring){const _=Math.min(t*n*n*100,128e3);return ee.update(d=>d+_),Se(a.position,_),j(O({},a),{isFiring:!1,isDestroyed:!0})}return u.includes(a.position)&&!a.isFiring&&!a.isDestroyed&&!a.isHoldover&&!l.includes(a.position)?j(O({},a),{isFiring:!0,isHoldover:!1,isHoldoverDisplay:!1}):a.isHoldover?j(O({},a),{isHoldoverDisplay:!0}):l.includes(a.position)&&!a.isDestroyed?j(O({},a),{isHoldover:!0,isFiring:!1}):a})}),await V(100),se(this.tiles).find(i=>i.isFiring||i.isHoldover&&!i.isHoldoverDisplay)&&await this.chainReact(e+1,t)}getNextChainTiles(){return se(this.tiles).filter(t=>t.isHoldover).map(t=>t.id)}async handleBomb(e){const t=[],i=[];if(this.tiles.update(n=>{if(n.find(s=>s.isHoldover))return n;for(const s of n)if(!!s.isDestroyed)for(const r of s.directions){const l=s.position.add(this.getDirectionVector(r));(l.x<0||l.x>=S)&&i.push(s.position.y),(l.y<0||l.y>=S)&&t.push(s.position.x)}return n}),t.length>0||i.length>0){await V(400);for(const n of t)He(b.create(n,0),b.create(1,S));for(const n of i)He(b.create(0,n),b.create(S,1));this.tiles.update(n=>{const s=n.filter(r=>r.isDestroyed||r.isFiring).length;return n.map(r=>{if(t.includes(r.position.x)||i.includes(r.position.y)){const l=Math.min(e*s*s*500,256e3);return ee.update(u=>u+l),Se(r.position,l),j(O({},r),{isDestroyed:!0})}return r})}),await V(350)}}async destroyTiles(){await V(250),this.tiles.update(e=>e.filter(t=>!t.isDestroyed))}async populateTiles(){this.tiles.update(e=>{const t=[];for(let i=0;i<S;i++)for(let n=0;n<S;n++){const s=b.create(i,n);if(!e.find(r=>r.position===s)){let r=-1;for(;t.includes(b.create(i,r));)r-=1;t.push(b.create(i,r))}}return e.concat(t.map(i=>this.generateTile(i)))}),await V(100)}async dropTiles(){const e={};this.tiles.update(i=>{var n;for(i=i.map(s=>O({},s));i.find(s=>s.position.y<0);)for(const s of i){const r=s.position.add(0,1);r.y<S&&!i.find(l=>l.position===r)&&(s.position=r,e[s.id]=((n=e[s.id])!=null?n:0)+1)}return i});let t=0;for(const i of Object.keys(e))t=Math.max(t,e[i]);await V(80*t)}generateTile(e){return{id:Wt(),position:e,directions:this.generateDirections(),isFiring:!1,isInteractable:!0,isDestroyed:!1,isHoldover:!1,isHoldoverDisplay:!1}}generateDirections(){const e=Math.random(),t=e<.8?1:e<.95?2:4;return _e([_e(["up","down"]),_e(["left","right"])]).flat().slice(0,t)}}function _e(o){o=[...o];let e=o.length,t;for(;e!=0;)t=Math.floor(Math.random()*e),e--,[o[e],o[t]]=[o[t],o[e]];return o}function Me(o,e,t){const i=o.slice();return i[21]=e[t],i}function Ce(o,e,t){const i=o.slice();return i[21]=e[t],i}function Be(o,e,t){const i=o.slice();return i[26]=e[t],i}function $e(o,e,t){const i=o.slice();return i[29]=e[t],i}function Fe(o,e){let t,i,n;function s(){return e[19](e[29])}return i=new Vt({props:{position:e[29].position,directions:e[29].directions,isInteractable:e[29].isInteractable&&e[29].directions.length===1,isDestroyed:e[29].isDestroyed,isHoldover:e[7].includes(e[29].id)||e[29].isHoldoverDisplay}}),i.$on("click",s),{key:o,first:null,c(){t=Q(),M(i.$$.fragment),this.first=t},m(r,l){y(r,t,l),C(i,r,l),n=!0},p(r,l){e=r;const u={};l[0]&64&&(u.position=e[29].position),l[0]&64&&(u.directions=e[29].directions),l[0]&64&&(u.isInteractable=e[29].isInteractable&&e[29].directions.length===1),l[0]&64&&(u.isDestroyed=e[29].isDestroyed),l[0]&192&&(u.isHoldover=e[7].includes(e[29].id)||e[29].isHoldoverDisplay),i.$set(u)},i(r){n||(p(i.$$.fragment,r),n=!0)},o(r){w(i.$$.fragment,r),n=!1},d(r){r&&v(t),B(i,r)}}}function Ge(o){let e,t;return e=new Tt({props:{position:o[26],isHighlighted:!1}}),{c(){M(e.$$.fragment)},m(i,n){C(e,i,n),t=!0},p:K,i(i){t||(p(e.$$.fragment,i),t=!0)},o(i){w(e.$$.fragment,i),t=!1},d(i){B(e,i)}}}function qe(o,e){let t,i,n;return i=new vt({props:{id:e[21].id,position:e[21].position,size:e[21].size}}),{key:o,first:null,c(){t=Q(),M(i.$$.fragment),this.first=t},m(s,r){y(s,t,r),C(i,s,r),n=!0},p(s,r){e=s;const l={};r[0]&256&&(l.id=e[21].id),r[0]&256&&(l.position=e[21].position),r[0]&256&&(l.size=e[21].size),i.$set(l)},i(s){n||(p(i.$$.fragment,s),n=!0)},o(s){w(i.$$.fragment,s),n=!1},d(s){s&&v(t),B(i,s)}}}function Ae(o,e){let t,i,n;return i=new qt({props:{id:e[21].id,position:e[21].position,amount:e[21].amount}}),{key:o,first:null,c(){t=Q(),M(i.$$.fragment),this.first=t},m(s,r){y(s,t,r),C(i,s,r),n=!0},p(s,r){e=s;const l={};r[0]&512&&(l.id=e[21].id),r[0]&512&&(l.position=e[21].position),r[0]&512&&(l.amount=e[21].amount),i.$set(l)},i(s){n||(p(i.$$.fragment,s),n=!0)},o(s){w(i.$$.fragment,s),n=!1},d(s){s&&v(t),B(i,s)}}}function Ee(o){let e,t;return e=new zt({props:{score:o[10]}}),e.$on("click",o[20]),{c(){M(e.$$.fragment)},m(i,n){C(e,i,n),t=!0},p(i,n){const s={};n[0]&1024&&(s.score=i[10]),e.$set(s)},i(i){t||(p(e.$$.fragment,i),t=!0)},o(i){w(e.$$.fragment,i),t=!1},d(i){B(e,i)}}}function Xt(o){let e=[],t=new Map,i,n,s=[],r=new Map,l,u=[],a=new Map,_,d,I,z=o[6];const F=f=>f[29].id;for(let f=0;f<z.length;f+=1){let c=$e(o,z,f),h=F(c);t.set(h,e[f]=Fe(h,c))}let k=o[15],g=[];for(let f=0;f<k.length;f+=1)g[f]=Ge(Be(o,k,f));const $=f=>w(g[f],1,1,()=>{g[f]=null});let P=o[8];const W=f=>f[21].id;for(let f=0;f<P.length;f+=1){let c=Ce(o,P,f),h=W(c);r.set(h,s[f]=qe(h,c))}let R=o[9];const ie=f=>f[21].id;for(let f=0;f<R.length;f+=1){let c=Me(o,R,f),h=ie(c);a.set(h,u[f]=Ae(h,c))}let T=o[2]>=ae&&!o[3]&&Ee(o);return{c(){for(let f=0;f<e.length;f+=1)e[f].c();i=L();for(let f=0;f<g.length;f+=1)g[f].c();n=L();for(let f=0;f<s.length;f+=1)s[f].c();l=L();for(let f=0;f<u.length;f+=1)u[f].c();_=L(),T&&T.c(),d=Q()},m(f,c){for(let h=0;h<e.length;h+=1)e[h].m(f,c);y(f,i,c);for(let h=0;h<g.length;h+=1)g[h].m(f,c);y(f,n,c);for(let h=0;h<s.length;h+=1)s[h].m(f,c);y(f,l,c);for(let h=0;h<u.length;h+=1)u[h].m(f,c);y(f,_,c),T&&T.m(f,c),y(f,d,c),I=!0},p(f,c){if(c[0]&2252&&(z=f[6],X(),e=he(e,c,F,1,f,z,t,i.parentNode,ge,Fe,i,$e),U()),c[0]&32768){k=f[15];let h;for(h=0;h<k.length;h+=1){const ve=Be(f,k,h);g[h]?(g[h].p(ve,c),p(g[h],1)):(g[h]=Ge(ve),g[h].c(),p(g[h],1),g[h].m(n.parentNode,n))}for(X(),h=k.length;h<g.length;h+=1)$(h);U()}c[0]&256&&(P=f[8],X(),s=he(s,c,W,1,f,P,r,l.parentNode,ge,qe,l,Ce),U()),c[0]&512&&(R=f[9],X(),u=he(u,c,ie,1,f,R,a,_.parentNode,ge,Ae,_,Me),U()),f[2]>=ae&&!f[3]?T?(T.p(f,c),c[0]&12&&p(T,1)):(T=Ee(f),T.c(),p(T,1),T.m(d.parentNode,d)):T&&(X(),w(T,1,1,()=>{T=null}),U())},i(f){if(!I){for(let c=0;c<z.length;c+=1)p(e[c]);for(let c=0;c<k.length;c+=1)p(g[c]);for(let c=0;c<P.length;c+=1)p(s[c]);for(let c=0;c<R.length;c+=1)p(u[c]);p(T),I=!0}},o(f){for(let c=0;c<e.length;c+=1)w(e[c]);g=g.filter(Boolean);for(let c=0;c<g.length;c+=1)w(g[c]);for(let c=0;c<s.length;c+=1)w(s[c]);for(let c=0;c<u.length;c+=1)w(u[c]);w(T),I=!1},d(f){for(let c=0;c<e.length;c+=1)e[c].d(f);f&&v(i),Xe(g,f),f&&v(n);for(let c=0;c<s.length;c+=1)s[c].d(f);f&&v(l);for(let c=0;c<u.length;c+=1)u[c].d(f);f&&v(_),T&&T.d(f),f&&v(d)}}}function Ut(o){let e,t,i,n,s,r,l;return ue(o[18]),t=new ft({props:{nodeSize:100,width:S,height:S,$$slots:{default:[Xt]},$$scope:{ctx:o}}}),n=new Bt({props:{numClicks:o[2],score:o[10]}}),{c(){e=D("main"),M(t.$$.fragment),i=L(),M(n.$$.fragment),m(e,"style",o[4]),m(e,"class","svelte-n6ahiz"),N(e,"input-blocked",o[5])},m(u,a){y(u,e,a),C(t,e,null),H(e,i),C(n,e,null),s=!0,r||(l=me(window,"resize",o[18]),r=!0)},p(u,a){const _={};a[0]&1996|a[1]&2&&(_.$$scope={dirty:a,ctx:u}),t.$set(_);const d={};a[0]&4&&(d.numClicks=u[2]),a[0]&1024&&(d.score=u[10]),n.$set(d),(!s||a[0]&16)&&m(e,"style",u[4]),a[0]&32&&N(e,"input-blocked",u[5])},i(u){s||(p(t.$$.fragment,u),p(n.$$.fragment,u),s=!0)},o(u){w(t.$$.fragment,u),w(n.$$.fragment,u),s=!1},d(u){u&&v(e),B(t),B(n),r=!1,l()}}}const Re=720,Oe=840;function Zt(o,e){return o>Re&&e>Oe?1:Math.min(o/Re,e/Oe)}function xt(o,e,t){let i,n,s,r,l,u,a,_;J(o,ye,c=>t(8,u=c)),J(o,pe,c=>t(9,a=c)),J(o,ee,c=>t(10,_=c));const d=new Qt,I=d.inputBlocked;J(o,I,c=>t(5,s=c));const z=d.tiles;J(o,z,c=>t(6,r=c));const F=d.highlightedTiles;J(o,F,c=>t(7,l=c));const k=[...Array(S*S).keys()].map(c=>b.create(c%S,Math.floor(c/S)));let g=0,$=!1;function P(){t(2,g=0),ee.set(0),d.reset()}let W,R;function ie(){t(0,W=window.innerWidth),t(1,R=window.innerHeight)}const T=async c=>{t(2,g+=1),t(3,$=!0),await d.clickTiles([c.id]),g>=ae&&ht(),t(3,$=!1)},f=()=>P();return o.$$.update=()=>{o.$$.dirty[0]&3&&t(17,i=Zt(W,R)),o.$$.dirty[0]&131072&&t(4,n=`transform: scale(${i})`)},[W,R,g,$,n,s,r,l,u,a,_,d,I,z,F,k,P,i,ie,T,f]}class ei extends q{constructor(e){super();A(this,e,xt,Ut,E,{},null,[-1,-1])}}new ei({target:document.getElementById("app")});export{ii as __vite_legacy_guard};
